<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Drupal-ci by atouchard</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="stylesheets/github.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body onload="prettyPrint()">
    <div class="wrapper">
      <header>
        <h1>Drupal-ci</h1>
        <p></p>

        <p class="view"><a href="https://github.com/atouchard/drupal-continuous-integration">View the Project on GitHub <small>atouchard/drupal-ci</small></a></p>

        <ul>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration">View On <strong>GitHub</strong></a></li>
        </ul>
        <a href="https://twitter.com/share" class="twitter-share-button" data-text="Drupal-continuous-integration | Continuous integration for Drupal" data-lang="fr" data-count="none">Tweet</a>
      </header>
      <section>
        <h3>Welcome to Drupal-ci Pages.</h3>

        <p>This project is a fork of <a href="http://jenkins-php.org/">Template for Jenkins Jobs for PHP Projects</a> by Sebastian Bergmann suitable for Drupal 6.</p>
        <p>For all your Drupal projects, it's not necessary to test Drupal Core and contrib modules.<br>The default configuration of this project suppose you have your custom code in <em>/src/sites/all/modules/custom</em> and <em>/src/sites/all/themes</em> folders. You can change these paths in <em>/properties/build.properties</em></p>
        <p>Below, you can watch a typical architecture of continuous integration :</p>
        <p><img src="images/ic.jpg" alt=""></p>
        <p>We use <a href="http://mercurial.selenic.com/">Mercurial</a> for versionning, <a href="http://jenkins-ci.org/">Jenkins</a> the continuous integration server and <a href="http://www.sonarsource.org/">Sonar</a> to manage code quality.</p>
        <div>We have 2 ant projects:
          <ul>
            <li>build.xml : default project (adapted from the original) launches common tasks.</li>
            <li>nightbuild.xml : deploy application on a remote server.</li>
          </ul>
        </div>
        <p>This project doesn't use the same configuration than <a href="http://jenkins-php.org/">Template for Jenkins Jobs for PHP Projects</a> because we use Drupal 6 (PHP 5.2).</p>
        <p>We need specific version of PEAR plugins and we use Doxygen for documentation with the help of <a href="https://github.com/mattfarina/drupal-6-doxygen">Matt Farina</a> instead of phpdox (PHP 5.3).</p>
        <h3>PEAR</h3>
        <p>To start, this is a typical installation for PEAR :</p>
        <pre><code>pear config-create ~/ .pearrc
mkdir -p ~/pear/lib
vi .bashrc
     PATH=$HOME/pear:$PATH
     export PATH
pear install -o PEAR</code></pre>
        <p>After that, you can add channels and install plugins (All of your plugins will go under the ~/pear folder).</p>
        <h4>Channel subscriptions</h4>
        <pre><code>pear channel-update pear.php.net
pear upgrade-all
pear channel-discover pear.pdepend.org
pear channel-discover pear.phpmd.org
pear channel-discover pear.phpunit.de
pear channel-discover components.ez.no
pear channel-discover pear.symfony-project.com</code></pre>
        <h4>Install plugins</h4>
        <pre><code>pear install channel://pear.php.net/Net_URL2-0.3.1
pear install channel://pear.php.net/HTTP_Request2-2.0.0RC1
pear  install --alldeps pdepend/PHP_Depend
pear install --alldeps phpmd/PHP_PMD
pear install phpunit/phpcpd-1.3.1
pear install --alldeps phpunit/phploc
pear install --alldeps PHPDocumentor
pear install --alldeps PHP_CodeSniffer
pear install --alldeps phpunit/PHP_CodeBrowser
pear install phpunit/PHPUnit-3.5.5</code></pre>
        <p>You can  view all plugins informations at <a href="http://phpqatools.org/">phpqatools.org</a></p>
        <h3>JENKINS</h3>
        <p>To install Jenkins, go to the <a href="http://jenkins-ci.org/">Jenkins website</a>, download application and follow the instructions.</p>
        <p>For example, on Ubuntu/Debian :</p>
        <pre><code>wget -q -O - http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -
deb http://pkg.jenkins-ci.org/debian binary/
sudo apt-get update
sudo apt-get install jenkins
sudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian binary/ > /etc/apt/sources.list.d/jenkins.list'
sudo aptitude update
sudo aptitude install jenkins</code></pre>
        <p>Then, run Jenkins on a specific port (--httpPort) :</p>
        <pre><code>nohup java -jar jenkins.war --httpPort=2000 > ~/logs/jenkins.log 2>&1</code></pre>
        <p>By default, Jenkins run on port 8080.<br>
        You can start Jenkins with <a href="https://wiki.jenkins-ci.org/display/JENKINS/Starting+and+Accessing+Jenkins">other command line parameters</a>.</p>
        <p>Go to <a href="http://127.0.0.1:2000">http://127.0.0.1:2000</a> to see Jenkins alive.</p>
        <p>You can use Jenkins client to download plugins easily :</p>
        <pre><code>wget http://127.0.0.1:2000/jnlpJars/jenkins-cli.jar</code></pre>
        <p>Now, install Jenkins useful plugins :</p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin checkstyle
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin cloverphp
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin dry
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin htmlpublisher
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin jdepend
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin plot
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin pmd
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin violations
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin xunit</code></pre>
        <p>Then, restart Jenkins safely :</p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 safe-restart</code></pre>
        <h3>SELENIUM</h3>
        <p>With <a href="http://seleniumhq.org/">Selenium</a>, you can create and execute functionnal tests of your code source.</p>
        <p>First, install the Selenium server :</p>
        <pre><code>mkdir ~/SELENIUM
cd ~/SELENIUM
wget http://selenium.googlecode.com/files/selenium-server-standalone-2.3.0.jar
ln -s selenium-server-standalone-2.3.0.jar selenium-server.jar</code></pre>
        <p>To launch your Selenium PHPUnit tests, run the Selenium server :</p>
        <pre><code>java -jar ~/SELENIUM/selenium-server.jar -port 4445</code></pre>
        <p>This is a basic Selenium test in PHPUnit format (<em>/tests/selenium/phpunit/Example.php</em>) :</p>
        <pre class="prettyprint"><code>&lt;?php

require_once 'PHPUnit/Extensions/SeleniumTestCase.php';

class Example extends PHPUnit_Extensions_SeleniumTestCase {
  protected function setUp() {
    $this->setHost("127.0.0.1");
    $this->setPort(4445);
    $this->setBrowser("*chrome");
    $this->setBrowserUrl("http://www.inserthtml.com/");
  }

  public function testMyTestCase() {
    $this->open("/");
    $this->type("xpath=(//input[@id='s'])[2]", "mobile");
    $this->click("css=#search > form > input[type=\"submit\"]");
    $this->waitForPageToLoad("30000");
    $this->verifyTextPresent("Creating a Mobile Web Application Part 1: Mobile Design");
  }
}
        </code></pre>
        <p>Run this Selenium test :</p>
        <pre><code>phpunit tests/selenium/phpunit/Example</code></pre>
        <h4>Selenium and Jenkins</h4>
        <p>In your Jenkins job configuration, add this script task to run :</p>
        <pre><code>export DISPLAY=":99" && java -jar ~/SELENIUM/selenium-server.jar -singleWindow -ensureCleanSession -browserSessionReuse -htmlSuite *firefox "http://yoursite/" "$WORKSPACE/tests/selenium/suites/Suite.html" "$WORKSPACE/tests/selenium/logs/selenium.html"</code></pre>
        <p>If you want more informations, you can go to <a href="http://centripetal.ca/blog/2011/02/07/getting-started-with-selenium-and-jenkins/">this article</a>.</p>
        <p>Download the <a href="http://wiki.hudson-ci.org/display/HUDSON/Seleniumhq+Plugin">seleniumhq</a> plugin for Jenkins.
        If you have the Jenkins client, you can run this command : </p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin seleniumhq</code></pre>
        <p>Then, restart Jenkins safely :</p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 safe-restart</code></pre>
        <h3>CONTACT</h3>
        <p>Feel free to contact me on <a href="https://github.com/atouchard">github</a> for more informations or <a href="https://github.com/atouchard/drupal-continuous-integration">fork it</a> !</p>
      </section>
      <footer>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js' type='text/javascript'></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </body>
</html>
