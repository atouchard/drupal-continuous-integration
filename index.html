<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Drupal-ci by atouchard</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="stylesheets/github.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body onload="prettyPrint()">
    <div class="wrapper">
      <header>
        <h1>Drupal-ci</h1>
        <p></p>

        <p class="view"><a href="https://github.com/atouchard/drupal-continuous-integration">View the Project on GitHub <small>atouchard/drupal-ci</small></a></p>

        <ul>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/atouchard/drupal-continuous-integration">View On <strong>GitHub</strong></a></li>
        </ul>
        <a href="https://twitter.com/share" class="twitter-share-button" data-text="Drupal-continuous-integration | Continuous integration for Drupal" data-lang="fr" data-count="none">Tweet</a>
      </header>
      <section>
        <h3>Welcome to Drupal-ci Pages.</h3>

        <p>This project is a fork of <a href="http://jenkins-php.org/">Template for Jenkins Jobs for PHP Projects</a> by Sebastian Bergmann suitable for Drupal 6.</p>
        <p>For all your Drupal projects, you don't need to test Drupal Core and contrib modules, just your modules and your themes.</p>
        <p>The default configuration analyzes custom code in <em>src/sites/all/modules/custom</em> and <em>src/sites/all/themes</em> folders. You can change these paths in <em>properties/build.properties</em></p>
        <p>Below, you can watch a typical architecture for continuous integration :</p>
        <img src="images/ic.jpg" alt="">
        <p>The basic tools are :</p>
        <ul>
          <li>an <abbr title="Source Code Management">SCM</abbr>, <a href="http://mercurial.selenic.com/">Mercurial</a> for example</li>
          <li><a href="http://jenkins-ci.org/">Jenkins</a>, the continuous integration server</li>
          <li><a href="http://www.sonarsource.org/">Sonar</a>, for love.</li>
        </ul>
        <div>
          <p><a href="http://ant.apache.org/">Ant</a> is used to manage tasks, you can also used Maven, Phing, ...</p>
          <ul>
            <li><strong>build.xml</strong> : default project (adapted from <a href="http://jenkins-php.org/">jenkins-php</a>) launches common tasks.</li>
            <li><strong>nightbuild.xml</strong> : deploy application on a remote server and launch Selenium tests.</li>
          </ul>
        </div>
        <p><strong>Note : </strong>If you run PHP under 5.3, you need specific versions of PEAR plugins and use Doxygen for documentation with the help of <a href="https://github.com/mattfarina/drupal-6-doxygen">Matt Farina</a> instead of phpdox (PHP 5.3).</p>
        <h3>PEAR</h3>
        <p>To start, this is a typical installation for PEAR :</p>
        <pre><code>pear config-create ~/ .pearrc
mkdir -p ~/pear/lib
vi .bashrc
     PATH=$HOME/pear:$PATH
     export PATH
pear install -o PEAR</code></pre>
        <p>Next, add channels and install PEAR package (All of your packages will go under the ~/pear folder).</p>
        <h4>Channel subscriptions</h4>
        <pre><code>pear channel-update pear.php.net
pear upgrade-all
pear channel-discover pear.pdepend.org
pear channel-discover pear.phpmd.org
pear channel-discover pear.phpunit.de
pear channel-discover components.ez.no
pear channel-discover pear.symfony-project.com</code></pre>
        <h4>Install plugins</h4>
        <pre><code>pear install channel://pear.php.net/Net_URL2-0.3.1
pear install channel://pear.php.net/HTTP_Request2-2.0.0RC1
pear install --alldeps pdepend/PHP_Depend
pear install --alldeps phpmd/PHP_PMD
pear install phpunit/phpcpd-1.3.1
pear install --alldeps phpunit/phploc
pear install --alldeps PHPDocumentor
pear install --alldeps PHP_CodeSniffer
pear install --alldeps phpunit/PHP_CodeBrowser
pear install phpunit/PHPUnit-3.5.5</code></pre>
        <p>You can  view all plugins informations at <a href="http://phpqatools.org/">phpqatools.org</a></p>
        <h3>JENKINS</h3>
        <p>To install Jenkins, go to the <a href="http://jenkins-ci.org/">Jenkins website</a>, download application and follow the instructions.</p>
        <p>For example, on Ubuntu/Debian :</p>
        <pre><code>wget -q -O - http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -
deb http://pkg.jenkins-ci.org/debian binary/
sudo apt-get update
sudo apt-get install jenkins
sudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian binary/ > /etc/apt/sources.list.d/jenkins.list'
sudo aptitude update
sudo aptitude install jenkins</code></pre>
        <p>Then, run Jenkins on a specific port (--httpPort) :</p>
        <pre><code>nohup java -jar jenkins.war --httpPort=2000 > ~/logs/jenkins.log 2>&1</code></pre>
        <p>By default, Jenkins run on port 8080.<br>
        You can start Jenkins with <a href="https://wiki.jenkins-ci.org/display/JENKINS/Starting+and+Accessing+Jenkins">other command line parameters</a>.</p>
        <p>Go to <a href="http://127.0.0.1:2000">http://127.0.0.1:2000</a> to see Jenkins alive.</p>
        <p>You can use <a href="https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+CLI">Jenkins client</a> to download plugins easily :</p>
        <pre><code>wget http://127.0.0.1:2000/jnlpJars/jenkins-cli.jar</code></pre>
        <p>Now, install Jenkins useful plugins :</p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin checkstyle
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin cloverphp
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin dry
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin htmlpublisher
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin jdepend
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin plot
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin pmd
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin violations
java -jar jenkins-cli.jar -s http://127.0.0.1:2000 install-plugin xunit</code></pre>
        <p>Then, restart Jenkins safely :</p>
        <pre><code>java -jar jenkins-cli.jar -s http://127.0.0.1:2000 safe-restart</code></pre>
        <h3>SELENIUM</h3>
        <p>First, download and install <a href="http://seleniumhq.org/">Selenium server</a> :</p>
        <pre><code>mkdir ~/SELENIUM
cd ~/SELENIUM
wget http://selenium.googlecode.com/files/selenium-server-standalone-2.3.0.jar

## Manage versions easily
ln -s selenium-server-standalone-2.3.0.jar selenium-server.jar</code></pre>
        <p>You need to have <a href="http://en.wikipedia.org/wiki/Xvfb">Xvfb</a> installed on server : </p>
        <pre><code>sudo apt-get install xvfb</code></pre>
        <p>and run it in background :</p>
        <pre><code>/usr/bin/Xvfb :99 -ac -screen 0 1024x768x8 &</code></pre>
        <p>If you want more informations, you can go to <a href="http://centripetal.ca/blog/2011/02/07/getting-started-with-selenium-and-jenkins/">this article</a>.</p>
        <p>To launch your Selenium PHPUnit tests, run the Selenium server :</p>
        <pre><code>java -jar ~/SELENIUM/selenium-server.jar -port 4445 -ensureCleanSession -browserSessionReuse -purgecaches</code></pre>
        <p>A basic Selenium test in PHPUnit format :</p>
        <pre class="prettyprint"><code>&lt;?php

class Example extends PHPUnit_Extensions_SeleniumTestCase
{
  protected function setUp()
  {
    $this->setHost("127.0.0.1");
    $this->setPort(4445);
    $this->setBrowser("*chrome");
    $this->setBrowserUrl("https://github.com/");
  }

  public function testMyTestCase()
  {
    $this->open("/");
    $this->click("link=Search");
    $this->waitForPageToLoad("30000");
    $this->type("name=q", "drupal");
    $this->click("css=button.classy");
    $this->waitForPageToLoad("30000");
    $this->verifyTextPresent("drupal / drupal");
  }
}
        </code></pre>
        <p>You can run this Selenium test thanks to PHPUnit :</p>
        <pre><code>phpunit tests/selenium/phpunit/Example</code></pre>
        <h4>Selenium and Jenkins</h4>
        <p>In your Jenkins job configuration, add this script task to run :</p>
        <pre><code>export DISPLAY=":99" && phpunit --log-junit=$WORKSPACE/tests/selenium/logs/selenium.xml --coverage-html=$WORKSPACE/tests/selenium/logs $WORKSPACE/tests/selenium/phpunit/AllTests.php</code></pre>
        <p>Now, in the Jenkins job configutation page, add post-build action to publish JUnit publish tests to tests/selenium/logs/selenium.xml</p>
        <p>Launch the job and voila !</p>
        <h3>CONTACT</h3>
        <p>Feel free to contact me on <a href="https://github.com/atouchard">github</a> for more informations or <a href="https://github.com/atouchard/drupal-continuous-integration">fork it</a> !</p>
      </section>
      <footer>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js' type='text/javascript'></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </body>
</html>
